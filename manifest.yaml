type: install
id: ghost-docker
version: '1.0'
appVersion: latest
name: Ghost (Docker Install)
baseUrl: https://raw.githubusercontent.com/TaylorJadin/Ghost-docker-jps/master/
logo: /ghost-logo.png
homepage: https://ghost.org/

categories: 
- apps/content-management

description: 
  text: Ghost is a free, open-source blogging platform with a user-friendly interface designed to simplify and speed up online publishing process.
  short: The professional publishing platform

globals:
  ghostdbPass: ${fn.password}

nodes:
  nodeType: dockerengine
  nodeGroup: cp
  cloudlets: 16
  extip: true
  addons: change-domain

settings:
domain: 
  fields: 
    - name: displayfield
      type: displayfield
      hideLabel: true
      markup: Make sure the the new domain is bound already to the environment via CNAME or via A Record 
    - name: domain
      hideLabel: true
      caption: Domain
      type: string
      vtype: extdomain

onInstall:
  - setup

actions:
  setup:      
    - cmd[cp]: |-
        wget https://raw.githubusercontent.com/TaylorJadin/Ghost-docker-jps/main/docker-compose.yml
        wget https://raw.githubusercontent.com/TaylorJadin/Ghost-docker-jps/main/.env
        sed -i.bak \
        -e "s|##DOMAIN##|${env.domain}|g" \
        -e "s|##EMAIL##|${user.email}|g" \
        -e "s|##DBPASS##|${globals.ghostdbPass}|g" \
        -e "s|##ROOTDBPASS##|${fn.password}|g" \
        .env
        docker-compose up -d

addons:
  - id: change-domain    
    name: Domain Configuration    
    description: You can change your current domain and issue valid Let's Encrypt certificates.
    permanent: true
    buttons:    
      - confirmText: Are you sure you want to proceed?
        loadingText: Changing domain...
        action: changeDomain
        caption: Change
        successText: The domain has been updated successfully!
        settings: domain
        title: Please specify the new domain name 
        
    actions:
      changeDomain:
        - cmd[cp]: |-
        sed -i.bak \
        -e "s|${env.domain}|${settings.domain}|g" \
        .env
        docker-compose up -d--force-recreate

success: | 
  **Ghost**: [https://${env.domain}/](https://${env.domain}/)  